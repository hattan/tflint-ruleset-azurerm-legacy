# This is a basic workflow that is manually triggered

name: vm_size

# Controls when the action will run. Workflow runs when manually triggered using the UI
# or API.
on:
  workflow_dispatch:
    # Inputs the workflow accepts.
    # inputs: None?

jobs:
  vm_size:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v2
    - name: Calculate diff
      run: |
        echo "Getting file from storage..."
        curl https://tflintrulesstore.z5.web.core.windows.net/vm-size.json --output rules/.tflint-azure-config/vm-size.json
        echo "Done."
        echo "Calculating diff..."
        git diff > vmsize_snapshot.diff
        echo "Done."
    - name: Check that json file is accessible
      uses: actions/github-script@v2
      with:
        github-token: ${{secrets.GITHUB_TOKEN}}
        script: |
          const fs = require('fs')
          const data = fs.readFileSync('rules/.tflint-azure-config/vm-size.json', 'utf-8')
          console.log("Contents of vm-size.json:diff.")
          console.log(data)
    - name: Regenerate Go code and create PR
      uses: actions/github-script@v2
      with:
        github-token: ${{secrets.GITHUB_TOKEN}}
        script: |
          const fs = require('fs')
          const data = fs.readFileSync('vmsize_snapshot.diff', 'utf-8')
          if (data === "") {
            console.log("No diff.")
            return
          }
          else {
            console.log("Diff exists.")
            // Write test first
            // Regenerate go code file
            // Read json file and store in array
            // Write go file

            // Create PR
            return
          }
